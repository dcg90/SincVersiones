async function loadLocalProducts(n){if(n!=null){const t=new URL("localProduct/products",window.location.origin);t.searchParams.append("page",n.toString());t.searchParams.append("limit",window._local_products_ipp);try{localProductsSpinner.fadeIn();const i=await $.get(t.toString()),r=$("#local-products").hide().html(i),u=+$("#total-pages").data("total-pages")||1;$("#local-products-pagination").bootpag({total:u,page:n,maxVisible:5});_setInputPriceValues("#local-products-table");r.fadeIn()}catch(i){displayErrorAlert("Ocurrió un error al cargar los productos.")}finally{localProductsSpinner.fadeOut()}}}function initPagination(){const n=$.fn.bootpag;$.fn.bootpag=function(t){const i=n.bind($(this))(t);return $("ul.pagination.bootpag li>a").addClass("page-link"),i};$("#local-products-pagination").bootpag({total:0,page:1,maxVisible:5,leaps:!0}).on("page",async function(n,t){await loadLocalProducts(t)})}async function addLocalProducts(){const n=[];if($('#synced-products div.add-product-cbox-container input[type="checkbox"]:checked').each(function(){const t=$(this).data("product-id");n.push({productId:t,price:+$(`input[name="Price_${t}"]`).val(),stock:+$(`input[name="Stock_${t}"]`).val()})}),n.length){const t=new URL("localProduct/create",window.location.origin);try{searchLocalProductsSpinner.fadeIn();await $.post({url:t.toString(),data:JSON.stringify({products:n}),contentType:"application/json; charset=utf-8"});loadLocalProducts(getCurrentPage());searchSyncedProducts()}catch(t){displayErrorAlert("Ocurrió un error mientras se creaban los productos.")}finally{$("#addLocalProductModal").modal("hide");searchLocalProductsSpinner.fadeOut()}}}async function searchSyncedProducts(){const n=new URL("localProduct/syncedProducts",window.location.origin);n.searchParams.append("limit",window._local_products_ipp);n.searchParams.append("skuOrName",$('#local-products-search input[name="sku-or-name"]').val());n.searchParams.append("brandId",$('#local-products-search select[name="brand"]').val());try{searchLocalProductsSpinner.fadeIn();const t=await $.get(n.toString()),i=$("#synced-products").hide().html(t);_setInputPriceValues("#synced-products");i.fadeIn()}catch(t){displayErrorAlert("Ocurrió un error al cargar los productos.")}finally{searchLocalProductsSpinner.fadeOut()}}function _setInputPriceValues(n){$(`${n} input[type="number"][data-price]`).each(function(){const n=$(this);n.val(n.data("price"))})}function initAddProductModal(){window.searchLocalProductsSpinner=$("#synced-products-loading");searchLocalProductsSpinner.hide();$("#add-local-product").click(addLocalProducts);$("#local-products-search button.btn-search-products").click(searchSyncedProducts)}function getCurrentPage(){return+$("#local-products-pagination li.active").attr("data-lp")}function initItemsPerPage(){function n(){$("#items-per-page li").removeClass("active");$(`#items-per-page li[data-ipp="${window._local_products_ipp}"]`).addClass("active")}window._local_products_ipp=$("#items-per-page li.active").data("ipp");n();$("#items-per-page li").click(function(){$(this).data("ipp")!==window._local_products_ipp&&(window._local_products_ipp=$(this).data("ipp"),n(),loadLocalProducts(getCurrentPage()))})}async function updateLocalProducts(){const n=[];if($("#local-products-table tr[data-local-product-id]").each(function(){const t=$(this);n.push({id:t.data("local-product-id"),price:+t.find('input[name^="Price_"]').val(),stock:+t.find('input[name^="Stock_"]').val()})}),n.length){const t=new URL("localProduct/update",window.location.origin);try{localProductsSpinner.fadeIn();await $.ajax({type:"PUT",url:t.toString(),data:JSON.stringify({products:n}),contentType:"application/json; charset=utf-8"});displaySuccessAlert("Productos actualizados correctamente.")}catch(t){displayErrorAlert("Ha ocurrido un error mientras se actualizaban los productos.")}finally{localProductsSpinner.fadeOut()}}}(function(n){"use strict";function i(t,i){this.itemsArray=[];this.$element=n(t);this.$element.hide();this.isSelect=t.tagName==="SELECT";this.multiple=this.isSelect&&t.hasAttribute("multiple");this.objectItems=i&&i.itemValue;this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=n('<div class="bootstrap-tagsinput"><\/div>');this.$input=n('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(i)}function u(n,t){if(typeof n[t]!="function"){var i=n[t];n[t]=function(n){return n[i]}}}function f(n,t){if(typeof n[t]!="function"){var i=n[t];n[t]=function(){return i}}}function t(n){return n?e.text(n).html():""}function o(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart),t}function s(t,i){var r=!1;return n.each(i,function(n,i){if(typeof i=="number"&&t.which===i)return r=!0,!1;if(t.which===i.which){var u=!i.hasOwnProperty("altKey")||t.altKey===i.altKey,f=!i.hasOwnProperty("shiftKey")||t.shiftKey===i.shiftKey,e=!i.hasOwnProperty("ctrlKey")||t.ctrlKey===i.ctrlKey;if(u&&f&&e)return r=!0,!1}}),r}var r={tagClass:function(){return"label label-info"},itemValue:function(n){return n?n.toString():n},itemText:function(n){return this.itemValue(n)},itemTitle:function(){return null},freeInput:!0,addOnBlur:!0,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!0,onTagExists:function(n,t){t.hide().fadeIn()},trimValue:!1,allowDuplicates:!1},e;i.prototype={constructor:i,add:function(i,r,u){var f=this,a,e,o,w,l,s,h;if((!f.options.maxTags||!(f.itemsArray.length>=f.options.maxTags))&&(i===!1||i)){if(typeof i=="string"&&f.options.trimValue&&(i=n.trim(i)),typeof i=="object"&&!f.objectItems)throw"Can't add objects when itemValue option is not set";if(!i.toString().match(/^\s*$/)){if(f.isSelect&&!f.multiple&&f.itemsArray.length>0&&f.remove(f.itemsArray[0]),typeof i=="string"&&this.$element[0].tagName==="INPUT"&&(a=f.options.delimiterRegex?f.options.delimiterRegex:f.options.delimiter,e=i.split(a),e.length>1)){for(o=0;o<e.length;o++)this.add(e[o],!0);r||f.pushVal();return}var c=f.options.itemValue(i),v=f.options.itemText(i),b=f.options.tagClass(i),y=f.options.itemTitle(i),p=n.grep(f.itemsArray,function(n){return f.options.itemValue(n)===c})[0];if(p&&!f.options.allowDuplicates){if(f.options.onTagExists){w=n(".tag",f.$container).filter(function(){return n(this).data("item")===p});f.options.onTagExists(i,w)}return}f.items().toString().length+i.length+1>f.options.maxInputLength||(l=n.Event("beforeItemAdd",{item:i,cancel:!1,options:u}),f.$element.trigger(l),l.cancel)||(f.itemsArray.push(i),s=n('<span class="tag '+t(b)+(y!==null?'" title="'+y:"")+'">'+t(v)+'<span data-role="remove"><\/span><\/span>'),s.data("item",i),f.findInputWrapper().before(s),s.after(" "),f.isSelect&&!n('option[value="'+encodeURIComponent(c)+'"]',f.$element)[0]&&(h=n("<option selected>"+t(v)+"<\/option>"),h.data("item",i),h.attr("value",c),f.$element.append(h)),r||f.pushVal(),(f.options.maxTags===f.itemsArray.length||f.items().toString().length===f.options.maxInputLength)&&f.$container.addClass("bootstrap-tagsinput-max"),f.$element.trigger(n.Event("itemAdded",{item:i,options:u})))}}},remove:function(t,i,r){var u=this,f;if(u.objectItems&&(t=typeof t=="object"?n.grep(u.itemsArray,function(n){return u.options.itemValue(n)==u.options.itemValue(t)}):n.grep(u.itemsArray,function(n){return u.options.itemValue(n)==t}),t=t[t.length-1]),t){if(f=n.Event("beforeItemRemove",{item:t,cancel:!1,options:r}),u.$element.trigger(f),f.cancel)return;n(".tag",u.$container).filter(function(){return n(this).data("item")===t}).remove();n("option",u.$element).filter(function(){return n(this).data("item")===t}).remove();n.inArray(t,u.itemsArray)!==-1&&u.itemsArray.splice(n.inArray(t,u.itemsArray),1)}i||u.pushVal();u.options.maxTags>u.itemsArray.length&&u.$container.removeClass("bootstrap-tagsinput-max");u.$element.trigger(n.Event("itemRemoved",{item:t,options:r}))},removeAll:function(){var t=this;for(n(".tag",t.$container).remove(),n("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal()},refresh:function(){var i=this;n(".tag",i.$container).each(function(){var r=n(this),u=r.data("item"),e=i.options.itemValue(u),o=i.options.itemText(u),s=i.options.tagClass(u),f;r.attr("class",null);r.addClass("tag "+t(s));r.contents().filter(function(){return this.nodeType==3})[0].nodeValue=t(o);i.isSelect&&(f=n("option",i.$element).filter(function(){return n(this).data("item")===u}),f.attr("value",e))})},items:function(){return this.itemsArray},pushVal:function(){var t=this,i=n.map(t.items(),function(n){return t.options.itemValue(n).toString()});t.$element.val(i,!0).trigger("change")},build:function(t){var i=this,h;if(i.options=n.extend({},r,t),i.objectItems&&(i.options.freeInput=!1),u(i.options,"itemValue"),u(i.options,"itemText"),f(i.options,"tagClass"),i.options.typeahead&&(h=i.options.typeahead||{},f(h,"source"),i.$input.typeahead(n.extend({},h,{source:function(t,r){function f(n){for(var u,f=[],t=0;t<n.length;t++)u=i.options.itemText(n[t]),e[u]=n[t],f.push(u);r(f)}this.map={};var e=this.map,u=h.source(t);n.isFunction(u.success)?u.success(f):n.isFunction(u.then)?u.then(f):n.when(u).then(f)},updater:function(n){return i.add(this.map[n]),this.map[n]},matcher:function(n){return n.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(n){return n.sort()},highlighter:function(n){var t=new RegExp("("+this.query+")","gi");return n.replace(t,"<strong>$1<\/strong>")}}))),i.options.typeaheadjs){var l=null,e={},c=i.options.typeaheadjs;n.isArray(c)?(l=c[0],e=c[1]):e=c;i.$input.typeahead(l,e).on("typeahead:selected",n.proxy(function(n,t){e.valueKey?i.add(t[e.valueKey]):i.add(t);i.$input.typeahead("val","")},i))}i.$container.on("click",n.proxy(function(){i.$element.attr("disabled")||i.$input.removeAttr("disabled");i.$input.focus()},i));if(i.options.addOnBlur&&i.options.freeInput)i.$input.on("focusout",n.proxy(function(){n(".typeahead, .twitter-typeahead",i.$container).length===0&&(i.add(i.$input.val()),i.$input.val(""))},i));i.$container.on("keydown","input",n.proxy(function(t){var r=n(t.target),u=i.findInputWrapper(),f,e,s,h;if(i.$element.attr("disabled")){i.$input.attr("disabled","disabled");return}switch(t.which){case 8:o(r[0])===0&&(f=u.prev(),f.length&&i.remove(f.data("item")));break;case 46:o(r[0])===0&&(e=u.next(),e.length&&i.remove(e.data("item")));break;case 37:s=u.prev();r.val().length===0&&s[0]&&(s.before(u),r.focus());break;case 39:h=u.next();r.val().length===0&&h[0]&&(h.after(u),r.focus())}var c=r.val().length,l=Math.ceil(c/5),a=c+l+1;r.attr("size",Math.max(this.inputSize,r.val().length))},i));i.$container.on("keypress","input",n.proxy(function(t){var r=n(t.target),u,f;if(i.$element.attr("disabled")){i.$input.attr("disabled","disabled");return}u=r.val();f=i.options.maxChars&&u.length>=i.options.maxChars;i.options.freeInput&&(s(t,i.options.confirmKeys)||f)&&(u.length!==0&&(i.add(f?u.substr(0,i.options.maxChars):u),r.val("")),i.options.cancelConfirmKeysOnEmpty===!1&&t.preventDefault());var e=r.val().length,o=Math.ceil(e/5),h=e+o+1;r.attr("size",Math.max(this.inputSize,r.val().length))},i));i.$container.on("click","[data-role=remove]",n.proxy(function(t){i.$element.attr("disabled")||i.remove(n(t.target).closest(".tag").data("item"))},i));i.options.itemValue===r.itemValue&&(i.$element[0].tagName==="INPUT"?i.add(i.$element.val()):n("option",i.$element).each(function(){i.add(n(this).attr("value"),!0)}))},destroy:function(){var n=this;n.$container.off("keypress","input");n.$container.off("click","[role=remove]");n.$container.remove();n.$element.removeData("tagsinput");n.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],i=this.$container[0];t&&t.parentNode!==i;)t=t.parentNode;return n(t)}};n.fn.tagsinput=function(t,r,u){var f=[];return this.each(function(){var e=n(this).data("tagsinput"),o;e?t||r?e[t]!==undefined&&(o=e[t].length===3&&u!==undefined?e[t](r,null,u):e[t](r),o!==undefined&&f.push(o)):f.push(e):(e=new i(this,t),n(this).data("tagsinput",e),f.push(e),this.tagName==="SELECT"&&n("option",n(this)).attr("selected","selected"),n(this).val(n(this).val()))}),typeof t=="string"?f.length>1?f:f[0]:f};n.fn.tagsinput.Constructor=i;e=n("<div />");n(function(){n("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);
/**
 * @preserve
 * bootpag - jQuery plugin for dynamic pagination
 *
 * Copyright (c) 2015 botmonster@7items.com
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://botmonster.com/jquery-bootpag/
 *
 * Version:  1.0.7
 *
 */
(function(n){n.fn.bootpag=function(t){function f(t,f){var h,y,c,l,a,p;f=parseInt(f,10);var e,s=i.maxVisible==0?1:i.maxVisible,y=i.maxVisible==1?0:1,v=Math.floor((f-1)/s)*s,o=t.find("li");i.page=f=f<0?0:f>i.total?i.total:f;o.removeClass(i.activeClass);e=f-1<1?1:i.leaps&&f-1>=i.maxVisible?Math.floor((f-1)/s)*s:f-1;i.firstLastUse&&o.first().toggleClass(i.disabledClass,f===1);h=o.first();i.firstLastUse&&(h=h.next());h.toggleClass(i.disabledClass,f===1).attr("data-lp",e).find("a").attr("href",r(e));y=i.maxVisible==1?0:1;e=f+1>i.total?i.total:i.leaps&&f+1<=i.total-i.maxVisible?v+i.maxVisible+y:f+1;c=o.last();i.firstLastUse&&(c=c.prev());c.toggleClass(i.disabledClass,f===i.total).attr("data-lp",e).find("a").attr("href",r(e));o.last().toggleClass(i.disabledClass,f===i.total);l=o.filter("[data-lp="+f+"]");a="."+[i.nextClass,i.prevClass,i.firstClass,i.lastClass].join(",.");l.not(a).length||(p=f<=v?-i.maxVisible:0,o.not(a).each(function(t){e=t+1+v+p;n(this).attr("data-lp",e).toggle(e<=i.total).find("a").html(e).attr("href",r(e))}),l=o.filter("[data-lp="+f+"]"));l.not(a).addClass(i.activeClass);u.data("settings",i)}function r(n){return i.href.replace(i.hrefVariable,n)}var u=this,i=n.extend({total:0,page:1,maxVisible:null,leaps:!0,href:"javascript:void(0);",hrefVariable:"{{number}}",next:"&raquo;",prev:"&laquo;",firstLastUse:!1,first:'<span aria-hidden="true">&larr;<\/span>',last:'<span aria-hidden="true">&rarr;<\/span>',wrapClass:"pagination",activeClass:"active",disabledClass:"disabled",nextClass:"next",prevClass:"prev",lastClass:"last",firstClass:"first"},u.data("settings")||{},t||{});return i.total<=0?this:(n.isNumeric(i.maxVisible)||i.maxVisible||(i.maxVisible=parseInt(i.total,10)),u.data("settings",i),this.each(function(){var h,s,o=n(this),t=['<ul class="',i.wrapClass,' bootpag">'],e;for(i.firstLastUse&&(t=t.concat(['<li data-lp="1" class="',i.firstClass,'"><a href="',r(1),'">',i.first,"<\/a><\/li>"])),i.prev&&(t=t.concat(['<li data-lp="1" class="',i.prevClass,'"><a href="',r(1),'">',i.prev,"<\/a><\/li>"])),e=1;e<=Math.min(i.total,i.maxVisible);e++)t=t.concat(['<li data-lp="',e,'"><a href="',r(e),'">',e,"<\/a><\/li>"]);i.next&&(s=i.leaps&&i.total>i.maxVisible?Math.min(i.maxVisible+1,i.total):2,t=t.concat(['<li data-lp="',s,'" class="',i.nextClass,'"><a href="',r(s),'">',i.next,"<\/a><\/li>"]));i.firstLastUse&&(t=t.concat(['<li data-lp="',i.total,'" class="last"><a href="',r(i.total),'">',i.last,"<\/a><\/li>"]));t.push("<\/ul>");o.find("ul.bootpag").remove();o.append(t.join(""));h=o.find("ul.bootpag");o.find("li").click(function(){var t=n(this),r;t.hasClass(i.disabledClass)||t.hasClass(i.activeClass)||(r=parseInt(t.attr("data-lp"),10),u.find("ul.bootpag").each(function(){f(n(this),r)}),u.trigger("page",r))});f(h,i.page)}))}})(jQuery,window);$(async function(){window.localProductsSpinner=$("#local-products-loading");$("#update-local-products").click(updateLocalProducts);initPagination();initItemsPerPage();initAddProductModal();loadLocalProducts(1)});